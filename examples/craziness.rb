require 'pry'
require_relative '../lib/text_interface'

def generate_layer(text)
  default_cell = lambda{ ' ' }
  canvas = CanvasCreator.new(text, Canvas, default_cell).generate_canvas
  CanvasLayer.new(canvas, 0, 0)
end

very_bottom = <<-EOF
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
EOF

bottom = <<-EOF
----------------
----------------
----------------
----------------
----------------
----------------
----------------
----------------
----------------
EOF

middle = <<-EOD
xx
xx
EOD

top = <<-EOF
o
EOF

@very_bottom_layer = generate_layer(very_bottom)
@bottom_layer = generate_layer(bottom)
@middle_layer = generate_layer(middle)
@top_layer = generate_layer(top)

@top_stack = CanvasStack.new
@top_stack.add_layer(@bottom_layer)
@top_stack.add_layer(@middle_layer)
@top_stack.add_layer(@top_layer)
@stitcher = CanvasStackStitcher.new(@top_stack, CanvasStitcher)

@bottom_stack = CanvasStack.new
@bottom_stack.add_layer(@very_bottom_layer)
@overlay_layer = CanvasLayer.new(lambda{ @stitcher.canvas }, 0, 0)
@bottom_stack.add_layer(@overlay_layer)

@bottom_stitcher = CanvasStackStitcher.new(@bottom_stack, CanvasStitcher)

def animate_layer(layer, direction, amount)
  layer.send("move_#{direction}", amount)
end

def render(stitcher, bottom_stitcher)
  STDOUT.puts "\n" * 100
  STDOUT.puts CanvasPrinter.new(bottom_stitcher.canvas).print
  sleep 0.05
end

def rendering stitcher, bottom_stitcher, &block
  yield
  render(stitcher, bottom_stitcher)
end

20.times do
  7.times do
    rendering(@stitcher, @bottom_stitcher) do
      animate_layer(@top_layer, :right, 1)
      animate_layer(@middle_layer, :down, 1)
      animate_layer(@overlay_layer, :down, 1)
    end
  end

  7.times do
    rendering(@stitcher, @bottom_stitcher) do
      animate_layer(@top_layer, :down, 1)
      animate_layer(@middle_layer, :right, 1)
      animate_layer(@overlay_layer, :right, 1)
    end
  end

  7.times do
    rendering(@stitcher, @bottom_stitcher) do
      animate_layer(@top_layer, :left, 1)
      animate_layer(@middle_layer, :up, 1)
      animate_layer(@overlay_layer, :up, 1)
    end
  end

  7.times do
    rendering(@stitcher, @bottom_stitcher) do
      animate_layer(@top_layer, :up, 1)
      animate_layer(@middle_layer, :left, 1)
      animate_layer(@overlay_layer, :left, 1)
    end
  end
end
